<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="config.mybatis.mapper.oracle.admin_Main">
	<select id="selectCountUser" resultType="int">
		select count(*) from
		rent_user
	</select>

	<select id="selectCountCompany" resultType="int">
		select count(*) from
		company
	</select>

	<select id="selectCountReservation" resultType="int">
		select count(*)
		from reservation
	</select>

	<select id="selectCountPayinfo" resultType="int">
		select count(*) from
		payinfo
	</select>

	<select id="selectSumTotalPay" resultType="map">
		select yyyy,
		sum("01") as "January", sum("02") as "February", sum("03") as "March",
		sum("04") as "April", sum("05") as "May", sum("06") as "June", 
		sum("07") as "July", sum("08") as "August",
		sum("09") as "September", sum("10") as "October", sum("11") as "November",
		sum("12") as "December", sum(pay_money) as "sales"
		from
		(
			select to_char(r.reserv_start_date,'YYYY') AS yyyy,
			to_char(r.reserv_start_date,'MM') AS MM, 
			to_char(r.reserv_start_date,'DD') AS DD, p.pay_money
			, decode(to_char(r.reserv_start_date,'MM'), '01', p.pay_money, 0) AS "01"
			, decode(to_char(r.reserv_start_date,'MM'), '02', p.pay_money, 0) AS "02"
			, decode(to_char(r.reserv_start_date,'MM'), '03', p.pay_money, 0) AS "03"
			, decode(to_char(r.reserv_start_date,'MM'), '04', p.pay_money, 0) AS "04"
			, decode(to_char(r.reserv_start_date,'MM'), '05', p.pay_money, 0) AS "05"
			, decode(to_char(r.reserv_start_date,'MM'), '06', p.pay_money, 0) AS "06"
			, decode(to_char(r.reserv_start_date,'MM'), '07', p.pay_money, 0) AS "07"
			, decode(to_char(r.reserv_start_date,'MM'), '08', p.pay_money, 0) AS "08"
			, decode(to_char(r.reserv_start_date,'MM'), '09', p.pay_money, 0) AS "09"
			, decode(to_char(r.reserv_start_date,'MM'), '10', p.pay_money, 0) AS "10"
			, decode(to_char(r.reserv_start_date,'MM'), '11', p.pay_money, 0) AS "11"
			, decode(to_char(r.reserv_start_date,'MM'), '12', p.pay_money, 0) AS "12"
			from reservation r join payinfo p
			on r.RESERV_NUM=p.RESERV_NUM
		)
		group by yyyy
		order by yyyy
	</select>

	<select id="selectSalesByMonth" parameterType="DateSearchVO"
		resultType="map">
		select to_char(orderdate, 'mm') as orderdate,
		sum(totalprice) as totalprice
		from orders
		where extract(year from orderdate)=#{year}
		group by to_char(orderdate, 'mm')
	</select>
	
	<select id="selectPayInfo" resultType="PayInfoVO" parameterType="PayInfoVO">
        select * from payInfo 
        order by pay_regdate desc
	</select>
	
	<update id="updatePayCancel" parameterType="String">
		update payInfo
		set pay_cancelDate=sysdate
		where reserv_num=#{reservNum}
	</update>
</mapper>









